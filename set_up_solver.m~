clear
clc

datastruct = load('smoothdata100imutime.mat') ;
tarray=[22];
data = {} ;
input = {} ;
t = {} ;
start=1;
done=50;



for idx = 1:length(tarray)
    trial = datastruct.(['processeddata_' num2str(tarray(idx))]) ;
    data{idx} = trial([2,3,20,10,26],start:done);
    input{idx} = [steeringmodel(trial(32,start:done));trial(8,start:done)];
    t{idx} = trial(1,start:done); 
end

%masses of rover components: rover 2.470 kg, floureon battery 0.289 kg, lrp
%battery 0.257 kg, traxx battery 0.260 kg
%esitmate for the lower bound of lf: .1585

fdyn = @lygerostan;

l=.29;
lf=.18;
m=2.759;
w=.3;
Izub=2.759/12*(l^2+w^2);
Izg=2.759/12*l^2;
lflb=.1585;

%p0=[m,1.5,1.9,2.9,1.5,1]';
%p0=[2.75893849260183;1.04994735141019;1.58831203610299;2.85390828742966;1.42480823604556;0.989058946688454];
p0=[2.75900429948152;1.50977345881792;1.71064381680499;2.91580325183189;1.6300920625783;0.991828882728394];
%p0=[2.75900403583027;3.17009399850943;2.04414190698034;2.97209935296703;2.31070149981126;1.00210589951561];
pub=[2.762,3000,2.8,3,10000,1.2]';
plb=[2.756,0,1.585,2.8,0,.8]';
scale=[1/10;1/10;1/10;1;1];


user = nonlinearModelFit(fdyn,t,data,input,p0,'pl',plb,'pu',pub) ;

