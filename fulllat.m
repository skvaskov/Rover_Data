function [dzdt,dfdz,dfdp]=fulllat(z,u,p)
%function with position (full model of slip/yaw function)
%u(1) should be steerin/100 u(2) should be longitudinal velocity
dzdt=[ u(2)*cos(z(3)+z(4));...
       u(2)*sin(z(3)+z(4));...
    -z(5)-(p(5)*(2*z(3)-p(6)*u(1)+(z(5)*(p(3)-p(4)))/(u(2)*cos(z(3)))))/(p(1)*u(2)*cos(z(3)));...
      z(5);...
    (p(4)*p(5)*(z(3)-(p(4)*z(5))/(u(2)*cos(z(3)))))/p(2)-(p(3)*p(5)*(z(3)-p(6)*u(1)+(p(3)*z(5))/(u(2)*cos(z(3)))))/p(2)];

dfdz=[ 0, 0,                                                                                                   -u(2)*sin(z(3) + z(4)), -u(2)*sin(z(3) + z(4)),                                       0;...
 0, 0,                                                                                                    u(2)*cos(z(3) + z(4)),  u(2)*cos(z(3) + z(4)),                                       0;...
 0, 0, -(p(5)*(2*u(2)*cos(z(3))^2 + z(3)*u(2)*sin(2*z(3)) + 2*p(3)*z(5)*sin(z(3)) - 2*p(4)*z(5)*sin(z(3)) - (p(6)*u(1)*u(2)*sin(2*z(3)))/2))/(p(1)*u(2)^2*cos(z(3))^3),              0, - (p(5)*(p(3) - p(4)))/(p(1)*u(2)^2*cos(z(3))^2) - 1;...
 0, 0,                                                                                                                0,              0,                                       1;...
 0, 0,                    - (p(3)*p(5)*((p(3)*z(5)*sin(z(3)))/(u(2)*cos(z(3))^2) + 1))/p(2) - (p(4)*p(5)*((p(4)*z(5)*sin(z(3)))/(u(2)*cos(z(3))^2) - 1))/p(2),              0,      -(p(5)*(p(3)^2 + p(4)^2))/(p(2)*u(2)*cos(z(3)))];

dfdp=[                                                               0,                                                                                     0,                                                             0,                                           0,                                                                           0,                      0;...
                                                               0,                                                                                     0,                                                             0,                                           0,                                                                           0,                      0;...
 (p(5)*(2*z(3) - p(6)*u(1) + (z(5)*(p(3) - p(4)))/(u(2)*cos(z(3)))))/(p(1)^2*u(2)*cos(z(3))),                                                                                     0,                                    -(p(5)*z(5))/(p(1)*u(2)^2*cos(z(3))^2),                   (p(5)*z(5))/(p(1)*u(2)^2*cos(z(3))^2),                   -(2*z(3) - p(6)*u(1) + (z(5)*(p(3) - p(4)))/(u(2)*cos(z(3))))/(p(1)*u(2)*cos(z(3))), (p(5)*u(1))/(p(1)*u(2)*cos(z(3)));...
                                                               0,                                                                                     0,                                                             0,                                           0,                                                                           0,                      0;...
                                                               0, (p(3)*p(5)*(z(3) - p(6)*u(1) + (p(3)*z(5))/(u(2)*cos(z(3)))))/p(2)^2 - (p(4)*p(5)*(z(3) - (p(4)*z(5))/(u(2)*cos(z(3)))))/p(2)^2, -(p(5)*(2*p(3)*z(5) + z(3)*u(2)*cos(z(3)) - p(6)*u(1)*u(2)*cos(z(3))))/(p(2)*u(2)*cos(z(3))), -(p(5)*(2*p(4)*z(5) - z(3)*u(2)*cos(z(3))))/(p(2)*u(2)*cos(z(3))), (p(4)*(z(3) - (p(4)*z(5))/(u(2)*cos(z(3)))))/p(2) - (p(3)*(z(3) - p(6)*u(1) + (p(3)*z(5))/(u(2)*cos(z(3)))))/p(2),          (p(3)*p(5)*u(1))/p(2)];

 

end
