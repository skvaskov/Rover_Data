function [dzdt,dfdz,dfdp ] = bikeparabolictire(z,u,p )
%parabolic pressure distribution for tire, constant normal forces, no
%"saturation" functions imposed on adhesion length
%p = [m,Iz,lf,l,a,k,mu,muo]';
x=z(1);
y=z(2);
psi=z(3);
vy=z(4);
w=z(5);
%
d=u(1);
vx=u(2);
%
scale=[1,.1,.1,.1,.01,1000,1,1];
m=p(1)*scale(1);
Iz=p(2)*scale(2);
lf=p(3)*scale(3);
l=p(4)*scale(4);
a=p(5)*scale(5);
k=p(6)*scale(6);
mu=p(7)*scale(7);
muo=p(8)*scale(8);

dzdt=[vx*cos(psi) - vy*sin(psi);...
                                                                                                                                                                                                                                                      vy*cos(psi) + vx*sin(psi);...
                                                                                                                                                                                                                                                                              w;...
 (981*lf*m*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*(1/m + ((l - lf)*(l/2 - lf))/Iz))/(100*l) - vx*w + (981*m*mu*cos(d)*(l - lf)*(1/m - (lf*(l/2 - lf))/Iz)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l);...
                                                  -((981*lf*m*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*(l - lf))/(100*l) - (981*lf*m*mu*cos(d)*(l - lf)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l))/Iz];
                                              
 

dfdz= [ 0, 0, - vy*cos(psi) - vx*sin(psi),                                                                                                                                                                                                                                                                                                                  -sin(psi),                                                                                                                                                                                                                                                                                                                                 0;...
 0, 0,   vx*cos(psi) - vy*sin(psi),                                                                                                                                                                                                                                                                                                                   cos(psi),                                                                                                                                                                                                                                                                                                                                 0;...
 0, 0,                           0,                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                                                                                                 1;...
 0, 0,                           0, (2*a^2*k*mu*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2*(1/m + ((l - lf)*(l/2 - lf))/Iz))/(muo*vx) - (2*a^2*k*mu*cos(d)*(tan(d - atan((vy + (l*w)/2)/vx))^2 + 1)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2*(1/m - (lf*(l/2 - lf))/Iz))/(muo*vx*((vy + (l*w)/2)^2/vx^2 + 1)), - vx - (a^2*k*l*mu*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2*(1/m + ((l - lf)*(l/2 - lf))/Iz))/(muo*vx) - (a^2*k*l*mu*cos(d)*(tan(d - atan((vy + (l*w)/2)/vx))^2 + 1)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2*(1/m - (lf*(l/2 - lf))/Iz))/(muo*vx*((vy + (l*w)/2)^2/vx^2 + 1));...
 0, 0,                           0,                                           -((2*a^2*k*mu*(l - lf)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2)/(muo*vx) + (2*a^2*k*lf*mu*cos(d)*(tan(d - atan((vy + (l*w)/2)/vx))^2 + 1)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2)/(muo*vx*((vy + (l*w)/2)^2/vx^2 + 1)))/Iz,                                                   ((a^2*k*l*mu*(l - lf)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2)/(muo*vx) - (a^2*k*l*lf*mu*cos(d)*(tan(d - atan((vy + (l*w)/2)/vx))^2 + 1)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2)/(muo*vx*((vy + (l*w)/2)^2/vx^2 + 1)))/Iz];

dfdp=[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                       0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                      0;...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                       0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                      0;...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                       0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                      0;...
 (981*lf*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*(1/m + ((l - lf)*(l/2 - lf))/Iz))/(100*l) - (981*lf*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1))/(100*l*m) + (981*mu*cos(d)*(l - lf)*(1/m - (lf*(l/2 - lf))/Iz)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l) - (981*mu*cos(d)*(l - lf)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l*m) - (2*a^2*k*mu*(vy - (l*w)/2)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2*(1/m + ((l - lf)*(l/2 - lf))/Iz))/(m*muo*vx) - (2*a^2*k*mu*tan(d - atan((vy + (l*w)/2)/vx))*cos(d)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2*(1/m - (lf*(l/2 - lf))/Iz))/(m*muo), (981*lf*m*mu*cos(d)*(l - lf)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1)*(l/2 - lf))/(100*Iz^2*l) - (981*lf*m*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*(l - lf)*(l/2 - lf))/(100*Iz^2*l), (981*m*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*(1/m + ((l - lf)*(l/2 - lf))/Iz))/(100*l) - (981*m*mu*cos(d)*(1/m - (lf*(l/2 - lf))/Iz)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l) - (981*lf*m*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*((l - lf)/Iz + (l/2 - lf)/Iz))/(100*l) + (981*m*mu*cos(d)*(l - lf)*(lf/Iz - (l/2 - lf)/Iz)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l) - (2*a^2*k*mu*(vy - (l*w)/2)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2*(1/m + ((l - lf)*(l/2 - lf))/Iz))/(lf*muo*vx) + (2*a^2*k*mu*tan(d - atan((vy + (l*w)/2)/vx))*cos(d)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2*(1/m - (lf*(l/2 - lf))/Iz))/(muo*(l - lf)), (981*m*mu*cos(d)*(1/m - (lf*(l/2 - lf))/Iz)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l) - (981*lf*m*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*(1/m + ((l - lf)*(l/2 - lf))/Iz))/(100*l^2) + (981*lf*m*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*((l - lf)/(2*Iz) + (l/2 - lf)/Iz))/(100*l) + (2943*lf*m*mu*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2*(1/m + ((l - lf)*(l/2 - lf))/Iz)*((200*a^2*k*(vy - (l*w)/2))/(2943*lf*m*muo*vx) - (100*a^2*k*l*w)/(2943*lf*m*muo*vx)))/(100*l) - (981*m*mu*cos(d)*(l - lf)*(1/m - (lf*(l/2 - lf))/Iz)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l^2) - (2943*m*mu*cos(d)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2*(l - lf)*(1/m - (lf*(l/2 - lf))/Iz)*((200*a^2*k*l*tan(d - atan((vy + (l*w)/2)/vx)))/(2943*m*muo*(l - lf)^2) - (200*a^2*k*tan(d - atan((vy + (l*w)/2)/vx)))/(2943*m*muo*(l - lf)) + (100*a^2*k*l*w*(tan(d - atan((vy + (l*w)/2)/vx))^2 + 1))/(2943*m*muo*vx*((vy + (l*w)/2)^2/vx^2 + 1)*(l - lf))))/(100*l) - (981*lf*m*mu*cos(d)*(l - lf)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(200*Iz*l), (4*a*k*mu*(vy - (l*w)/2)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2*(1/m + ((l - lf)*(l/2 - lf))/Iz))/(muo*vx) + (4*a*k*mu*tan(d - atan((vy + (l*w)/2)/vx))*cos(d)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2*(1/m - (lf*(l/2 - lf))/Iz))/muo, (2*a^2*mu*(vy - (l*w)/2)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2*(1/m + ((l - lf)*(l/2 - lf))/Iz))/(muo*vx) + (2*a^2*mu*tan(d - atan((vy + (l*w)/2)/vx))*cos(d)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2*(1/m - (lf*(l/2 - lf))/Iz))/muo, (981*lf*m*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*(1/m + ((l - lf)*(l/2 - lf))/Iz))/(100*l) + (981*m*cos(d)*(l - lf)*(1/m - (lf*(l/2 - lf))/Iz)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l), - (2*a^2*k*mu*(vy - (l*w)/2)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2*(1/m + ((l - lf)*(l/2 - lf))/Iz))/(muo^2*vx) - (2*a^2*k*mu*tan(d - atan((vy + (l*w)/2)/vx))*cos(d)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2*(1/m - (lf*(l/2 - lf))/Iz))/muo^2;...
                                                                                                                                                                                                                                                                                                         -((981*lf*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*(l - lf))/(100*l) - (981*lf*mu*cos(d)*(l - lf)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l) - (2*a^2*k*mu*(vy - (l*w)/2)*(l - lf)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2)/(m*muo*vx) + (2*a^2*k*lf*mu*tan(d - atan((vy + (l*w)/2)/vx))*cos(d)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2)/(m*muo))/Iz,                          ((981*lf*m*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*(l - lf))/(100*l) - (981*lf*m*mu*cos(d)*(l - lf)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l))/Iz^2,                                                                                                                                                  ((981*lf*m*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1))/(100*l) - (981*m*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*(l - lf))/(100*l) - (981*lf*m*mu*cos(d)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l) + (981*m*mu*cos(d)*(l - lf)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l) + (2*a^2*k*mu*(vy - (l*w)/2)*(l - lf)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2)/(lf*muo*vx) + (2*a^2*k*lf*mu*tan(d - atan((vy + (l*w)/2)/vx))*cos(d)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2)/(muo*(l - lf)))/Iz,                                                                                                                                                                                                                                                                                       -((981*lf*m*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1))/(100*l) - (981*lf*m*mu*cos(d)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l) - (981*lf*m*mu*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*(l - lf))/(100*l^2) + (981*lf*m*mu*cos(d)*(l - lf)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l^2) + (2943*lf*m*mu*(l - lf)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2*((200*a^2*k*(vy - (l*w)/2))/(2943*lf*m*muo*vx) - (100*a^2*k*l*w)/(2943*lf*m*muo*vx)))/(100*l) + (2943*lf*m*mu*cos(d)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2*(l - lf)*((200*a^2*k*l*tan(d - atan((vy + (l*w)/2)/vx)))/(2943*m*muo*(l - lf)^2) - (200*a^2*k*tan(d - atan((vy + (l*w)/2)/vx)))/(2943*m*muo*(l - lf)) + (100*a^2*k*l*w*(tan(d - atan((vy + (l*w)/2)/vx))^2 + 1))/(2943*m*muo*vx*((vy + (l*w)/2)^2/vx^2 + 1)*(l - lf))))/(100*l))/Iz,                                            ((4*a*k*lf*mu*tan(d - atan((vy + (l*w)/2)/vx))*cos(d)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2)/muo - (4*a*k*mu*(vy - (l*w)/2)*(l - lf)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2)/(muo*vx))/Iz,                                            ((2*a^2*lf*mu*tan(d - atan((vy + (l*w)/2)/vx))*cos(d)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2)/muo - (2*a^2*mu*(vy - (l*w)/2)*(l - lf)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2)/(muo*vx))/Iz,                                           -((981*lf*m*(((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^3 + 1)*(l - lf))/(100*l) - (981*lf*m*cos(d)*(l - lf)*(((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^3 + 1))/(100*l))/Iz,                                              ((2*a^2*k*mu*(vy - (l*w)/2)*(l - lf)*((200*k*l*(vy - (l*w)/2)*a^2)/(2943*lf*m*muo*vx) - 1)^2)/(muo^2*vx) - (2*a^2*k*lf*mu*tan(d - atan((vy + (l*w)/2)/vx))*cos(d)*((200*k*l*tan(d - atan((vy + (l*w)/2)/vx))*a^2)/(2943*m*muo*(l - lf)) - 1)^2)/muo^2)/Iz];
  
%scaling
scale=repmat(scale,5,1);
  dfdp=scale.*dfdp;
end

